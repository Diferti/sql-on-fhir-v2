{
  "title": "rowkey",
  "author": ["jmandel"],
  "resources": [
    {
      "resourceType": "Observation",
      "id": "o1",
      "basedOn": [
        { "reference": "ServiceRequest/123" },
        { "reference": "https://example.org/fhir/ServiceRequest/456" },
        { "reference": "CarePlan/123" }
      ]
    }
  ],
  "tests": [
    {
      "title": "rowkey at observation level",
      "view": {
        "resource": "Observation",
        "select": [{ "path": "getRowKey()", "alias": "id" }]
      },
      "expectCount": 1
    },
    {
      "title": "rowkey at reference level",
      "view": {
        "resource": "Observation",
        "forEach": "basedOn",
        "select": [{ "alias": "rid", "path": "getRowKey()" }]
      },
      "expectCount": 3
    },
    {
      "title": "rowkey at reference level with resource param",
      "view": {
        "resource": "Observation",
        "forEach": "basedOn.where(getRowKey('CarePlan').exists())",
        "select": [{ "alias": "rid", "path": "getRowKey()" }]
      },
      "expectCount": 1
    }
  ]
}
